<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>NNITRO SYSTEM v2026</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --accent: #ff0000; --bg: #050505; --text: #00ff00; }
        body { background: var(--bg); color: var(--text); font-family: monospace; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* –û–ö–ù–û –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò/–í–•–û–î–ê */
        #auth-screen { position: fixed; inset: 0; background: #000; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 2px solid var(--accent); }
        .auth-box { width: 320px; padding: 20px; border: 1px solid #333; }
        input { width: 100%; padding: 10px; margin: 5px 0; background: #111; border: 1px solid #444; color: #fff; outline: none; }
        .btn { cursor: pointer; background: var(--accent); color: #fff; border: none; padding: 10px; width: 100%; font-weight: bold; margin-top: 10px; }
        
        /* –ì–õ–ê–í–ù–´–ô –ò–ù–¢–ï–†–§–ï–ô–° */
        #main-app { display: none; width: 100%; }
        .sidebar { width: 280px; border-right: 1px solid #222; display: flex; flex-direction: column; }
        .chat-area { flex: 1; display: flex; flex-direction: column; background: #0a0a0a; }
        
        /* –°–ü–ò–°–û–ö –Æ–ó–ï–†–û–í */
        .u-list { flex: 1; overflow-y: auto; }
        .user-card { padding: 10px; border-bottom: 1px solid #111; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .user-card:hover { background: #151515; }
        .online-dot { width: 8px; height: 8px; background: lime; border-radius: 50%; }

        /* –°–û–û–ë–©–ï–ù–ò–Ø */
        #messages { flex: 1; overflow-y: auto; padding: 15px; }
        .msg { margin-bottom: 10px; padding: 8px; border-radius: 4px; max-width: 80%; word-wrap: break-word; }
        .msg.admin { border-left: 3px solid gold; }
        .msg.me { background: #1a1a1a; align-self: flex-end; margin-left: auto; }
        .msg b { color: var(--accent); font-size: 0.8em; }

        /* –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø (–¢–û–õ–¨–ö–û –î–õ–Ø VAaD) */
        #admin-panel { display: none; background: #200; padding: 10px; border-bottom: 2px solid red; gap: 10px; }
        .adm-btn { font-size: 11px; background: red; color: white; border: none; padding: 4px; cursor: pointer; }

        /* –ì–û–õ–û–°–û–í–´–ï */
        .voice-btn { font-size: 20px; cursor: pointer; background: none; border: none; }
        .recording { color: red; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }
    </style>
</head>
<body>

<div id="auth-screen">
    <div class="auth-box">
        <h2 style="text-align:center; color:red">NNITRO-2026</h2>
        <input id="login" placeholder="–õ–æ–≥–∏–Ω (VAaD –¥–ª—è –∞–¥–º–∏–Ω–∞)">
        <input id="pass" type="password" placeholder="–ü–∞—Ä–æ–ª—å (zip123 –¥–ª—è –∞–¥–º–∏–Ω–∞)">
        
        <div id="reg-only">
            <input id="secret-key" placeholder="–í–í–ï–î–ò–¢–ï –ö–û–î –î–û–°–¢–£–ü–ê">
        </div>

        <button class="btn" onclick="login()">–í–û–ô–¢–ò</button>
        <button class="btn" style="background:#333" onclick="register()">–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</button>
    </div>
</div>

<div id="main-app">
    <div class="sidebar">
        <div id="admin-panel">
            <button class="adm-btn" onclick="admAction('ban')">BAN</button>
            <button class="adm-btn" onclick="admAction('clear')">CLEAR CHAT</button>
            <button class="adm-btn" onclick="admAction('verify')">SET VIP</button>
        </div>
        <div style="padding:15px; border-bottom:1px solid #222">
            <b id="my-name">---</b> <br>
            <small id="my-status" style="color:#555">Online</small>
        </div>
        <div class="u-list" id="user-list">
            <div class="user-card" onclick="switchChat('GLOBAL')">üåê –û–ë–©–ò–ô –ß–ê–¢</div>
            <div class="user-card" onclick="switchChat('ZIP_AI')">ü§ñ –ù–ï–ô–†–û–°–ï–¢–¨ –ó–ò–ü</div>
        </div>
    </div>

    <div class="chat-area">
        <div style="padding:10px; background:#000; border-bottom:1px solid #222" id="chat-header">–û–ë–©–ò–ô –ß–ê–¢</div>
        <div id="messages"></div>
        <div style="padding:15px; display:flex; gap:10px; background:#000">
            <button id="rec-btn" class="voice-btn" onclick="toggleVoice()">üéôÔ∏è</button>
            <input id="m-input" style="margin:0" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
            <button class="btn" style="width:80px; margin:0" onclick="send()">SEND</button>
        </div>
    </div>
</div>

<script>
    // ==========================================
    // –°–¢–†–û–ö–ê –° –ö–û–î–û–ú (–ò–ó–ú–ï–ù–ò –¢–£–¢ –ï–°–õ–ò –ù–ê–î–û)
    const ACCESS_KEY = "NNITRO-2026";
    // ==========================================

    const firebaseConfig = { databaseURL: "https://nnitro-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let user = null;
    let targetChat = "GLOBAL";
    let mediaRecorder, audioChunks = [];

    // –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø
    async function register() {
        const l = document.getElementById('login').value.trim();
        const p = document.getElementById('pass').value;
        const k = document.getElementById('secret-key').value.trim();

        if (k !== ACCESS_KEY) return alert("–ù–ï–í–ï–†–ù–´–ô –ö–û–î –î–û–°–¢–£–ü–ê!");
        if (l.length < 3) return alert("–ù–ò–ö –°–õ–ò–®–ö–û–ú –ö–û–†–û–¢–ö–ò–ô!");

        const check = await db.ref('u/' + l).once('value');
        if (check.exists()) return alert("–ù–ò–ö –ó–ê–ù–Ø–¢!");

        const newUser = {
            n: l, p: p, 
            v: (l === "VAaD"), // –ê–¥–º–∏–Ω–∫–∞ –µ—Å–ª–∏ –Ω–∏–∫ VAaD
            reg: Date.now(),
            b: false // –ù–µ –∑–∞–±–∞–Ω–µ–Ω
        };
        await db.ref('u/' + l).set(newUser);
        alert("–£—Å–ø–µ—à–Ω–æ! –¢–µ–ø–µ—Ä—å –Ω–∞–∂–º–∏ –í–û–ô–¢–ò");
    }

    // –í–•–û–î
    async function login() {
        const l = document.getElementById('login').value.trim();
        const p = document.getElementById('pass').value;

        const snap = await db.ref('u/' + l).once('value');
        if (!snap.exists() || snap.val().p !== p) return alert("–û–®–ò–ë–ö–ê –í–•–û–î–ê");
        if (snap.val().b) return alert("–¢–´ –ó–ê–ë–ê–ù–ï–ù!");

        user = snap.val();
        startApp();
    }

    function startApp() {
        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('main-app').style.display = 'flex';
        document.getElementById('my-name').innerText = user.n;
        
        if (user.v) document.getElementById('admin-panel').style.display = 'flex';

        // –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–µ—Ç–∏
        db.ref('u').on('value', s => {
            const list = document.getElementById('user-list');
            list.innerHTML = `<div class="user-card" onclick="switchChat('GLOBAL')">üåê –û–ë–©–ò–ô –ß–ê–¢</div>`;
            list.innerHTML += `<div class="user-card" onclick="switchChat('ZIP_AI')">ü§ñ –ù–ï–ô–†–û–°–ï–¢–¨ –ó–ò–ü</div>`;
            
            s.forEach(child => {
                const u = child.val();
                if (u.n === user.n || u.b) return;
                list.innerHTML += `
                    <div class="user-card" onclick="switchChat('${u.n}')">
                        <div class="online-dot"></div>
                        <div>
                            <b>${u.v ? 'üíé ' : ''}${u.n}</b><br>
                            <small style="font-size:9px; color:#444">–†–µ–≥: ${new Date(u.reg).toLocaleDateString()}</small>
                        </div>
                    </div>`;
            });
        });
        switchChat('GLOBAL');
    }

    function switchChat(t) {
        targetChat = t;
        document.getElementById('chat-header').innerText = t;
        const path = (t === 'GLOBAL' || t === 'ZIP_AI') ? 'rooms/'+t : 'priv/' + [user.n, t].sort().join('_');
        
        db.ref(path).off();
        db.ref(path).limitToLast(50).on('value', s => {
            const box = document.getElementById('messages');
            box.innerHTML = '';
            s.forEach(m => {
                const d = m.val();
                let content = d.msg.startsWith('data:audio') ? `<audio src="${d.msg}" controls></audio>` : d.msg;
                box.innerHTML += `<div class="msg ${d.u === user.n ? 'me' : ''}"><b>${d.u}:</b><br>${content}</div>`;
            });
            box.scrollTop = box.scrollHeight;
        });
    }

    function send(txt = null) {
        const val = txt || document.getElementById('m-input').value.trim();
        if (!val) return;
        const path = (targetChat === 'GLOBAL' || targetChat === 'ZIP_AI') ? 'rooms/'+targetChat : 'priv/' + [user.n, targetChat].sort().join('_');
        
        db.ref(path).push({ u: user.n, msg: val, t: Date.now() });
        document.getElementById('m-input').value = '';

        if (targetChat === 'ZIP_AI' && !txt) {
            setTimeout(() => {
                db.ref(path).push({ u: 'ZIP_AI', msg: "–ó–∞–ø—Ä–æ—Å –ø—Ä–∏–Ω—è—Ç –≤ –æ–±—Ä–∞–±–æ—Ç–∫—É. –°–∏—Å—Ç–µ–º–∞ NNITRO –∞–∫—Ç–∏–≤–Ω–∞.", t: Date.now() });
            }, 800);
        }
    }

    // –ì–û–õ–û–°–û–í–´–ï
    async function toggleVoice() {
        const btn = document.getElementById('rec-btn');
        if (!mediaRecorder || mediaRecorder.state === "inactive") {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            mediaRecorder = new MediaRecorder(stream);
            mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
            mediaRecorder.onstop = () => {
                const reader = new FileReader();
                reader.readAsDataURL(new Blob(audioChunks));
                reader.onloadend = () => send(reader.result);
                audioChunks = [];
            };
            mediaRecorder.start();
            btn.classList.add('recording');
        } else {
            mediaRecorder.stop();
            btn.classList.remove('recording');
        }
    }

    // –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨
    async function admAction(type) {
        const target = prompt("–ù–∏–∫ —é–∑–µ—Ä–∞:");
        if (!target && type !== 'clear') return;
        if (type === 'ban') await db.ref('u/'+target).update({ b: true });
        if (type === 'verify') await db.ref('u/'+target).update({ v: true });
        if (type === 'clear') {
            const path = (targetChat === 'GLOBAL' || targetChat === 'ZIP_AI') ? 'rooms/'+targetChat : 'priv/' + [user.n, targetChat].sort().join('_');
            db.ref(path).remove();
        }
    }
</script>
</body>
</html>
