<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NNITRO 2026 | VAaD ULTIMATE SYSTEM</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --apple-bg: #ffffff; --apple-gray: #f2f2f7; --apple-blue: #007aff; --apple-border: rgba(0,0,0,0.1); }
        * { box-sizing: border-box; font-family: -apple-system, sans-serif; transition: all 0.3s ease; }
        body, html { margin: 0; padding: 0; background: var(--apple-bg); height: 100vh; overflow: hidden; }

        /* –ò–ù–¢–ï–†–§–ï–ô–°: –ü–ö vs –¢–ï–õ–ï–§–û–ù */
        #app { display: grid; height: 100vh; width: 100vw; }
        @media (min-width: 900px) { #app { grid-template-columns: 380px 1fr; } .back-btn { display: none; } }
        @media (max-width: 899px) { #app { grid-template-columns: 1fr; } .sidebar.hidden-mobile { display: none; } .chat-window.hidden-mobile { display: none; } }

        /* SIDEBAR (–ú–ï–ù–Æ) */
        .sidebar { background: #fff; border-right: 1px solid var(--apple-border); display: flex; flex-direction: column; z-index: 10; }
        .header { height: 70px; padding: 0 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--apple-border); font-weight: 700; font-size: 22px; }
        .search-box { padding: 10px 15px; }
        .search-box input { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid var(--apple-border); background: var(--apple-gray); }
        .user-list { flex: 1; overflow-y: auto; }
        .user-item { padding: 15px 20px; display: flex; align-items: center; gap: 15px; cursor: pointer; border-bottom: 1px solid #f9f9f9; }
        .user-item:hover { background: var(--apple-gray); }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; }

        /* CHAT WINDOW */
        .chat-window { display: flex; flex-direction: column; position: relative; background: #fff; }
        #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; }
        .msg { max-width: 75%; padding: 12px 16px; border-radius: 20px; font-size: 15px; position: relative; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .msg.in { align-self: flex-start; background: var(--apple-gray); border-bottom-left-radius: 5px; }
        .msg.out { align-self: flex-end; background: var(--apple-blue); color: #fff; border-bottom-right-radius: 5px; }
        .input-area { padding: 20px; border-top: 1px solid var(--apple-border); display: flex; gap: 10px; align-items: center; }
        .input-area input { flex: 1; padding: 12px; border-radius: 20px; border: none; background: var(--apple-gray); outline: none; }

        /* –§–ò–ù–ê–õ–´: –ú–£–¢–ê–¶–ò–Ø –ò –õ–ï–ö–ê–†–°–¢–í–û */
        #mutation-screen { position: fixed; inset: 0; z-index: 99999; display: none; background: #000; color: #fff; text-align: center; padding-top: 20vh; font-family: monospace; }
        #horror-overlay { 
            position: fixed; inset: 0; z-index: 99998; display: none; pointer-events: none;
            background: url('https://www.transparenttextures.com/patterns/circuit-board.png') #001a00;
            clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%, 0 0, 15% 15%, 85% 15%, 85% 85%, 15% 85%, 15% 15%);
        }
        #cure-screen { position: fixed; inset: 0; background: #fff; z-index: 100000; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 40px; }
        
        /* –ê–ù–ò–ú–ê–¶–ò–ò */
        .virus-win { filter: invert(1) hue-rotate(180deg); animation: shake 0.1s infinite; }
        @keyframes shake { 0% { transform: translate(1px, 1px); } 50% { transform: translate(-1px, -1px); } }

        /* –ó–í–£–ö–ò –ò –ó–í–û–ù–ö–ò */
        .call-ui { position: absolute; top: 80px; right: 20px; background: #fff; padding: 15px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); display: none; z-index: 100; }
        .btn-call { font-size: 25px; border: none; background: none; cursor: pointer; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="horror-overlay"></div>
<div id="mutation-screen">
    <h1 style="font-size: 100px;">:(</h1>
    <h2>–°–ò–°–¢–ï–ú–ê –ü–ï–†–ï–ó–ê–ì–†–£–ñ–ê–ï–¢–°–Ø...</h2>
    <h1 id="virus-timer">23:59:59</h1>
</div>
<div id="cure-screen">
    <h2 style="color: #007aff;">–ò–ó–í–ò–ù–ò–¢–ï –ß–¢–û –ó–ê–°–¢–ê–í–õ–Ø–ï–ú –ñ–î–ê–¢–¨,<br>–ù–û –ú–´ –£–ù–ò–ß–¢–û–ñ–ê–ï–ú –í–ò–†–£–° –õ–ï–ö–ê–†–°–¢–í–û–ú</h2>
    <h1 id="cure-timer" style="font-size: 60px;">05:00:00</h1>
</div>

<div id="auth-gate" style="position: fixed; inset: 0; background: #fff; z-index: 100001; display: flex; align-items: center; justify-content: center;">
    <div style="width: 320px; text-align: center;">
        <h1 style="font-size: 45px; letter-spacing: -3px; margin-bottom: 30px;">NNITRO</h1>
        <div style="display: flex; margin-bottom: 20px; background: #eee; border-radius: 12px; padding: 2px;">
            <button onclick="setAuthMode('login')" id="t-log" style="flex:1; padding:10px; border:none; border-radius:10px; background:#fff;">–í–æ–π—Ç–∏</button>
            <button onclick="setAuthMode('reg')" id="t-reg" style="flex:1; padding:10px; border:none; border-radius:10px; background:none;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        </div>
        <input type="text" id="n-nick" placeholder="–ù–∏–∫–Ω–µ–π–º">
        <input type="email" id="n-mail" placeholder="E-mail (VIP: –æ—Å—Ç–∞–≤—å –ø—É—Å—Ç—ã–º)">
        <input type="password" id="n-pass" placeholder="–ü–∞—Ä–æ–ª—å –∏–ª–∏ —è—à–∑123">
        <button onclick="handleAuth()" style="width: 100%; padding: 15px; background: #007aff; color: #fff; border: none; border-radius: 15px; font-weight: bold; margin-top: 15px; cursor: pointer;">–í–û–ô–¢–ò –í –°–ò–°–¢–ï–ú–£</button>
    </div>
</div>

<div id="app" class="hidden">
    <div class="sidebar" id="side-p">
        <div class="header">
            NNITRO 2026 
            <span id="ghost-status" style="font-size: 10px; color: #aaa;"></span>
        </div>
        <div class="search-box">
            <input type="text" id="user-search" placeholder="–ü–æ–∏—Å–∫ –ø—Ä–æ—Ñ–∏–ª–µ–π..." oninput="searchUsers()">
        </div>
        <div class="user-list" id="u-list">
            </div>
        <div id="vaad-info" class="hidden" style="padding: 15px; background: #000; color: #0f0; font-family: monospace; font-size: 11px;">
            <div>–†–ï–ì–ò–°–¢–†–ê–¶–ò–ô: <span id="stat-regs">0</span></div>
            <div>–û–ù–õ–ê–ô–ù: <span id="stat-on">0</span></div>
            <div>–ß–ê–¢–û–í: <span id="stat-chats">0</span></div>
            <button onclick="triggerCure()" style="background: green; color: #fff; border: none; margin-top: 5px; width: 100%;">–ó–ê–ü–£–°–¢–ò–¢–¨ –õ–ï–ß–ï–ù–ò–ï</button>
            <button onclick="roulette()" style="background: red; color: #fff; border: none; margin-top: 5px; width: 100%;">–†–£–õ–ï–¢–ö–ê (INFECT)</button>
        </div>
    </div>

    <div class="chat-window hidden-mobile" id="chat-p">
        <div class="header">
            <button class="back-btn" onclick="showSidebar()">‚¨ÖÔ∏è</button>
            <span id="active-chat-name">–ì–ª–æ–±–∞–ª—å–Ω—ã–π —á–∞—Ç</span>
            <button onclick="startCall()" style="background: none; border: none; font-size: 20px;">üìû</button>
        </div>
        <div id="messages"></div>
        <div class="call-ui" id="call-box">
            <div style="margin-bottom: 10px;">–í—Ö–æ–¥—è—â–∏–π –≤—ã–∑–æ–≤...</div>
            <button class="btn-call" onclick="endCall()" style="color: green;">$\diamondsuit$</button> <button class="btn-call" onclick="endCall()" style="color: red;">$\ast$</button> </div>
        <div class="input-area">
            <button onclick="sendEmoji('üëç')" style="background: none; border: none; font-size: 20px;">üëç</button>
            <input type="text" id="m-input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
            <button onclick="sendMessage()" style="color: #007aff; background: none; border: none; font-weight: bold;">SEND</button>
        </div>
    </div>
</div>

<script>
    // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE (–¢–≤–æ—è –±–∞–∑–∞) ---
    const firebaseConfig = {
        apiKey: "AIzaSyAThHqr7jix2KbL7q9kc3JJ4_dMpn09q-o",
        authDomain: "nnitro-system.firebaseapp.com",
        databaseURL: "https://nnitro-system-default-rtdb.firebaseio.com",
        projectId: "nnitro-system"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let myNick = "", myRole = "user", isInfected = false, currentTarget = "global", authMode = "login";

    // --- –õ–û–ì–ò–ö–ê –í–•–û–î–ê ---
    function setAuthMode(m) {
        authMode = m;
        document.getElementById('t-log').style.background = m === 'login' ? '#fff' : 'none';
        document.getElementById('t-reg').style.background = m === 'reg' ? '#fff' : 'none';
    }

    function handleAuth() {
        const nick = document.getElementById('n-nick').value.trim();
        const pass = document.getElementById('n-pass').value;
        const mail = document.getElementById('n-mail').value;

        if (!nick || !pass) return alert("–ó–∞–ø–æ–ª–Ω–∏ –ø–æ–ª—è!");

        const isVIP = (pass === "—è—à–∑123");
        
        if (authMode === 'reg') {
            if (!isVIP && !mail.includes('@')) return alert("–ù—É–∂–µ–Ω E-mail –∏–ª–∏ —Å–ø–µ—Ü-–∫–æ–¥!");
            db.ref('users/' + nick).set({
                online: true,
                infected: false,
                role: isVIP ? 'admin' : 'user',
                mail: isVIP ? 'VIP-HIDDEN' : mail,
                status: 'online'
            });
            db.ref('system/stats/totalRegs').transaction(c => (c || 0) + 1);
            enterApp(nick, isVIP ? 'admin' : 'user');
        } else {
            db.ref('users/' + nick).once('value', s => {
                if (s.exists()) enterApp(nick, s.val().role);
                else alert("–ù–µ—Ç —Ç–∞–∫–æ–≥–æ —é–∑–µ—Ä–∞!");
            });
        }
    }

    function enterApp(n, r) {
        myNick = n; myRole = r;
        document.getElementById('auth-gate').classList.add('hidden');
        document.getElementById('app').classList.remove('hidden');
        if (r === 'admin') document.getElementById('vaad-info').classList.remove('hidden');
        db.ref('users/' + n).update({ online: true, status: 'online' });
        initSystem();
    }

    // --- –°–ò–°–¢–ï–ú–ê –ß–ê–¢–ê –ò –ó–ê–†–ê–ñ–ï–ù–ò–Ø ---
    function sendMessage() {
        const text = document.getElementById('m-input').value;
        if (!text) return;
        postMessage(text, false);
        document.getElementById('m-input').value = "";
    }

    function sendEmoji(e) { postMessage(e, true); }

    function postMessage(t, isLike) {
        const msgData = {
            sender: myNick,
            text: t,
            isLike: isLike,
            infected: isInfected,
            timestamp: Date.now()
        };
        db.ref('messages/' + currentTarget).push(msgData);
        db.ref('system/stats/totalChats').transaction(c => (c || 0) + 1);
        
        // –†–æ—Å—Ç –≤–∏—Ä—É—Å–∞ –µ—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å –∑–∞—Ä–∞–∂–µ–Ω
        if (isInfected) db.ref('system/virusLevel').transaction(v => (v || 0) + 1);
    }

    function initSystem() {
        // –°–ª—É—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
        db.ref('messages/' + currentTarget).limitToLast(50).on('value', s => {
            const box = document.getElementById('messages');
            box.innerHTML = "";
            s.forEach(snap => {
                const m = snap.val();
                // –õ–û–ì–ò–ö–ê –¢–ò–•–û–ì–û –ó–ê–†–ê–ñ–ï–ù–ò–Ø
                if (m.infected && m.sender !== myNick && myRole !== 'admin' && !isInfected) {
                    let chance = m.isLike ? 0.3 : 1.0; // 30% –µ—Å–ª–∏ –ª–∞–π–∫, 100% –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç
                    if (Math.random() < chance) {
                        isInfected = true;
                        db.ref('users/' + myNick).update({ infected: true });
                    }
                }
                const cls = m.sender === myNick ? 'out' : 'in';
                box.innerHTML += `<div class="msg ${cls}"><b>${m.sender}</b><br>${m.text}</div>`;
            });
            box.scrollTop = box.scrollHeight;
        });

        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–±–µ–∑ –Ω–∞–∫—Ä—É—Ç–æ–∫)
        db.ref('system/stats').on('value', s => {
            const d = s.val();
            document.getElementById('stat-regs').innerText = d.totalRegs || 0;
            document.getElementById('stat-chats').innerText = d.totalChats || 0;
        });
        db.ref('users').on('value', s => {
            const u = s.val();
            document.getElementById('stat-on').innerText = Object.values(u).filter(x => x.online).length;
            renderUserList(u);
            if (u[myNick] && u[myNick].infected) isInfected = true;
        });

        // –ì–û–ù–ö–ê: –í–ò–†–£–° vs –õ–ï–ö–ê–†–°–¢–í–û
        db.ref('system').on('value', snap => {
            const s = snap.val();
            if (s.virusLevel >= 51 && s.cureLevel < 51) {
                document.body.classList.add('virus-win');
                document.getElementById('mutation-screen').style.display = 'block';
                setTimeout(() => { document.getElementById('horror-overlay').style.display = 'block'; }, 5000);
            }
            if (s.cureLevel >= 51) {
                if (isInfected) {
                    document.getElementById('cure-screen').style.display = 'flex';
                    db.ref('users/' + myNick).update({ status: '–ª–µ—á–∏—Ç—Å—è' });
                }
            }
        });
    }

    // --- –ú–û–ë–ò–õ–¨–ù–û–ï –ú–ï–ù–Æ ---
    function openChat(name) {
        currentTarget = name;
        document.getElementById('active-chat-name').innerText = name;
        if (window.innerWidth < 900) {
            document.getElementById('side-p').classList.add('hidden-mobile');
            document.getElementById('chat-p').classList.remove('hidden-mobile');
        }
        initSystem();
    }

    function showSidebar() {
        document.getElementById('side-p').classList.remove('hidden-mobile');
        document.getElementById('chat-p').classList.add('hidden-mobile');
    }

    function renderUserList(users) {
        const list = document.getElementById('u-list');
        list.innerHTML = `<div class="user-item" onclick="openChat('global')"><b>üì¢ –ì–õ–û–ë–ê–õ–¨–ù–´–ô –ß–ê–¢</b></div>`;
        Object.keys(users).forEach(u => {
            if (u === myNick) return;
            const color = users[u].status === '–ª–µ—á–∏—Ç—Å—è' ? 'orange' : (users[u].online ? 'green' : 'gray');
            list.innerHTML += `<div class="user-item" onclick="openChat('${u}')">
                <div class="status-dot" style="background:${color}"></div>
                <span>${u}</span>
                <span style="font-size:9px; opacity:0.5;">${users[u].status}</span>
            </div>`;
        });
    }

    // --- –ê–î–ú–ò–ù –§–£–ù–ö–¶–ò–ò ---
    function triggerCure() { db.ref('system/cureLevel').set(100); }
    function roulette() {
        db.ref('users').once('value', s => {
            const keys = Object.keys(s.val());
            const rand = keys[Math.floor(Math.random() * keys.length)];
            db.ref('users/' + rand).update({ infected: true });
            alert("–ò–Ω—Ñ–µ–∫—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞ –≤: " + rand);
        });
    }

    function startCall() { document.getElementById('call-box').style.display = 'block'; }
    function endCall() { document.getElementById('call-box').style.display = 'none'; }

</script>
</body>
</html>
