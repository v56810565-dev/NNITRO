<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>NNITRO OFFICIAL</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --main: #ff8c00; --bg: #050505; --panel: #111; --text: #fff; --ver: #00b3ff; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }
        
        /* AUTH */
        #auth { position: fixed; inset: 0; background: var(--main); z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .auth-card { background: #000; padding: 30px; border-radius: 20px; width: 340px; text-align: center; }
        input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #222; background: #111; color: #fff; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-main { background: var(--main); color: #fff; }

        /* APP */
        #app { display: none; height: 100vh; flex-direction: row; }
        .sidebar { width: 350px; background: var(--panel); border-right: 1px solid #222; display: flex; flex-direction: column; }
        
        /* ADMIN PANEL */
        #adm-bar { display: none; background: #1a1a1a; padding: 10px; flex-wrap: wrap; gap: 5px; border-bottom: 2px solid var(--main); }
        #adm-bar button { background: #000; color: var(--main); border: 1px solid var(--main); padding: 5px; font-size: 10px; cursor: pointer; border-radius: 4px; }

        .side-head { padding: 15px; background: #000; border-bottom: 1px solid #222; }
        .u-item { padding: 12px 15px; border-bottom: 1px solid #1a1a1a; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .u-item:hover { background: #151515; }
        .emoji-ava { font-size: 24px; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background: #222; border-radius: 10px; }
        
        /* CHAT */
        .chat { flex: 1; display: flex; flex-direction: column; background: #080808; }
        .chat-head { padding: 15px; background: #000; border-bottom: 1px solid #222; display: flex; justify-content: space-between; }
        .msgs { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .m { max-width: 70%; padding: 10px; border-radius: 12px; font-size: 14px; position: relative; }
        .m.in { background: #1a1a1a; align-self: flex-start; border-bottom-left-radius: 2px; }
        .m.out { background: var(--main); align-self: flex-end; border-bottom-right-radius: 2px; }
        .m small { display: block; font-size: 9px; opacity: 0.6; margin-bottom: 3px; }

        /* CONTROLS */
        .controls { padding: 15px; background: #000; display: flex; gap: 10px; align-items: center; }
        .rec-active { color: red; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        /* MODALS */
        #code-box { position: fixed; bottom: 20px; right: 20px; background: #000; border: 1px solid var(--main); padding: 10px; border-radius: 10px; color: var(--main); display: none; z-index: 3000; }
        @media (max-width: 700px) { .sidebar { width: 100%; } .chat { display: none; } .chat.active { display: flex; position: fixed; inset: 0; z-index: 100; } }
    </style>
</head>
<body>

<div id="auth">
    <div class="auth-card">
        <h2 style="color:var(--main); margin-bottom:10px;">NNITRO 2026</h2>
        <input id="un" placeholder="–õ–û–ì–ò–ù (VAaD)">
        <input id="up" type="password" placeholder="–ü–ê–†–û–õ–¨ (zip123)">
        <div id="reg-area" style="display:none">
            <input id="ucode" placeholder="–ö–û–î –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø">
        </div>
        <button class="btn btn-main" id="auth-btn" onclick="handleAuth()">–í–•–û–î</button>
        <p onclick="toggleReg()" id="switch-txt" style="font-size:12px; margin-top:15px; cursor:pointer; opacity:0.6">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</p>
    </div>
</div>

<div id="code-box">–°–ò–°–¢–ï–ú–ù–´–ô –ö–û–î: <b id="sys-val">0000</b></div>

<div id="app">
    <div class="sidebar">
        <div id="adm-bar">
            <button onclick="adm('ban')">–ë–ê–ù/–†–ê–ó–ë–ê–ù</button>
            <button onclick="adm('ver')">–ìAL–û–ß–ö–ê</button>
            <button onclick="adm('clear')">–ß–ò–°–¢–ö–ê –ß–ê–¢–ê</button>
            <button onclick="adm('bl')">–ß–ï–†–ù–´–ô –°–ü–ò–°–û–ö</button>
        </div>
        <div class="side-head">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <b id="my-name" onclick="toggleAdm()">–ó–∞–≥—Ä—É–∑–∫–∞...</b>
                <span id="online-count" style="font-size:10px; color: #0f0;">‚óè 0</span>
            </div>
            <small id="my-date" style="font-size:9px; color:#555;"></small>
        </div>
        <div id="user-list" style="flex:1; overflow-y:auto;"></div>
    </div>

    <div class="chat" id="chat-win">
        <div class="chat-head">
            <button onclick="document.getElementById('chat-win').classList.remove('active')" style="background:none; border:none; color:#fff; cursor:pointer;">‚Üê</button>
            <b id="chat-target">–û–ë–©–ò–ô –ß–ê–¢</b>
            <div id="target-emoji" class="emoji-ava" style="width:30px; height:30px; font-size:16px;">üí¨</div>
        </div>
        <div class="msgs" id="msgs"></div>
        <div class="controls">
            <button id="rec-btn" onclick="toggleRec()" style="background:none; border:none; cursor:pointer; font-size:20px;">üé§</button>
            <input id="m-in" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." style="margin:0;">
            <button class="btn btn-main" style="width:60px; padding:8px;" onclick="sendText()">OK</button>
        </div>
    </div>
</div>

<script>
    // 1. –ö–û–ù–§–ò–ì
    const firebaseConfig = { databaseURL: "https://nnitro-system-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let my = {}, cur = "GLOBAL", isReg = false, sysCode = "";
    let mediaRecorder, chunks = [];

    // 2. –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø
    function toggleReg() {
        isReg = !isReg;
        document.getElementById('reg-area').style.display = isReg ? 'block' : 'none';
        document.getElementById('code-box').style.display = isReg ? 'block' : 'none';
        document.getElementById('auth-btn').innerText = isReg ? '–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø' : '–í–•–û–î';
        if(isReg) {
            sysCode = Math.floor(1000 + Math.random() * 9000).toString();
            document.getElementById('sys-val').innerText = sysCode;
        }
    }

    async function handleAuth() {
        const n = document.getElementById('un').value.trim();
        const p = document.getElementById('up').value;
        if(!n || !p) return alert("–ü—É—Å—Ç–æ!");

        if(isReg) {
            if(document.getElementById('ucode').value !== sysCode) return alert("–ö–æ–¥ –Ω–µ–≤–µ—Ä–Ω—ã–π!");
            const s = await db.ref('users/'+n).once('value');
            if(s.exists()) return alert("–ò–º—è –∑–∞–Ω—è—Ç–æ!");
            my = { n, p, reg: new Date().toLocaleString(), v: (n==='VAaD'), e: 'üë§', online: true };
            await db.ref('users/'+n).set(my);
        } else {
            const s = await db.ref('users/'+n).once('value');
            if(!s.exists() || s.val().p !== p) return alert("–û—à–∏–±–∫–∞!");
            if(s.val().banned) return alert("–í–´ –í –ß–ï–†–ù–û–ú –°–ü–ò–°–ö–ï!");
            my = s.val();
            await db.ref('users/'+n).update({ online: true });
        }
        start();
    }

    // 3. –†–ê–ë–û–¢–ê –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
    function start() {
        document.getElementById('auth').style.display = 'none';
        document.getElementById('app').style.display = 'flex';
        document.getElementById('my-name').innerHTML = my.n + (my.v ? ' <span style="color:#00b3ff">‚úî</span>':'');
        document.getElementById('my-date').innerText = "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: " + my.reg;
        
        // –°–ø–∏—Å–æ–∫ —é–∑–µ—Ä–æ–≤ –∏ –æ–Ω–ª–∞–π–Ω
        db.ref('users').on('value', snap => {
            const list = document.getElementById('user-list');
            list.innerHTML = `<div class="u-item" onclick="openChat('GLOBAL')"><div class="emoji-ava">üåç</div><div><b>–û–ë–©–ò–ô –ß–ê–¢</b><br><small>–í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏</small></div></div>`;
            list.innerHTML += `<div class="u-item" onclick="openChat('ZIP_AI')"><div class="emoji-ava">ü§ñ</div><div><b>ZIP NEURO</b><br><small>–ù–µ–π—Ä–æ—Å–µ—Ç—å —Å–∏—Å—Ç–µ–º—ã</small></div></div>`;
            
            let on = 0;
            snap.forEach(u => {
                const d = u.val();
                if(d.online) on++;
                if(d.n === my.n || d.banned) return;
                list.innerHTML += `
                    <div class="u-item" onclick="openChat('${d.n}', '${d.e}')">
                        <div class="emoji-ava">${d.e}</div>
                        <div style="flex:1">
                            <b>${d.n} ${d.v ? 'üíô':''}</b><br>
                            <small>${d.online ? '–û–Ω–ª–∞–π–Ω' : '–ë—ã–ª –Ω–µ–¥–∞–≤–Ω–æ'}</small>
                        </div>
                    </div>`;
            });
            document.getElementById('online-count').innerText = "‚óè " + on;
        });

        openChat('GLOBAL');
    }

    // 4. –ß–ê–¢ –ò –ì–û–õ–û–°–û–í–´–ï
    function openChat(t, emoji = 'üë§') {
        cur = t;
        document.getElementById('chat-target').innerText = t;
        document.getElementById('target-emoji').innerText = emoji === 'üë§' ? 'üí¨' : emoji;
        document.getElementById('chat-win').classList.add('active');

        const path = (t==='GLOBAL' || t==='ZIP_AI') ? 'rooms/'+t : 'direct/'+[my.n, t].sort().join('_');
        db.ref(path).off();
        db.ref(path).limitToLast(50).on('value', snap => {
            const box = document.getElementById('msgs'); box.innerHTML = '';
            snap.forEach(m => {
                const d = m.val();
                const isVox = d.t.startsWith('data:audio');
                let content = isVox ? `<audio controls src="${d.t}" style="width:200px; height:30px;"></audio>` : d.t;
                box.innerHTML += `<div class="m ${d.u===my.n?'out':'in'}"><small>${d.u}</small>${content}</div>`;
            });
            box.scrollTop = box.scrollHeight;
        });
    }

    function sendText() {
        const val = document.getElementById('m-in').value.trim();
        if(!val) return;
        pushMsg(val);
        document.getElementById('m-in').value = '';
        if(cur === 'ZIP_AI') {
            setTimeout(() => pushMsg("ü§ñ –ó–ò–ü: –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω. –ö–æ–¥ NNITRO-2026 –∞–∫—Ç–∏–≤–µ–Ω. –ù–∞—Ä—É—à–µ–Ω–∏–π –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ.", "ZIP_AI"), 600);
        }
    }

    function pushMsg(t, sender = my.n) {
        const path = (cur==='GLOBAL' || cur==='ZIP_AI') ? 'rooms/'+cur : 'direct/'+[my.n, cur
