<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NNITRO 2026</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root {
            --bg: #ffffff;
            --panel: #f2f2f7;
            --text: #000000;
            --accent: #007aff;
            --msg-in: #e9e9eb;
            --msg-out: #007aff;
        }

        .dark-mode {
            --bg: #000000;
            --panel: #1c1c1e;
            --text: #ffffff;
            --msg-in: #3a3a3c;
            --msg-out: #0a84ff;
        }

        * { box-sizing: border-box; font-family: -apple-system, sans-serif; transition: 0.3s ease; }
        body { margin: 0; background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }

        /* --- –í–•–û–î --- */
        #auth-screen { 
            position: fixed; inset: 0; z-index: 1000; background: var(--bg);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .auth-box { width: 300px; text-align: center; }
        .auth-box h1 { font-weight: 700; letter-spacing: -1px; margin-bottom: 30px; }
        input { 
            width: 100%; padding: 14px; margin: 8px 0; border: none; 
            background: var(--panel); border-radius: 12px; color: var(--text); outline: none;
        }

        /* --- –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù --- */
        #app { display: grid; grid-template-columns: 350px 1fr; height: 100vh; }
        #sidebar { background: var(--bg); border-right: 1px solid rgba(0,0,0,0.1); display: flex; flex-direction: column; }
        #chat { display: flex; flex-direction: column; background: var(--bg); }

        .header { 
            padding: 20px; font-weight: 700; font-size: 20px; 
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 8px; }
        .m { max-width: 75%; padding: 10px 16px; border-radius: 20px; font-size: 16px; line-height: 1.3; }
        .m.in { align-self: flex-start; background: var(--msg-in); color: var(--text); }
        .m.out { align-self: flex-end; background: var(--msg-out); color: #fff; }
        .m b { display: block; font-size: 11px; opacity: 0.5; margin-bottom: 2px; }

        /* --- –ü–ê–ù–ï–õ–¨ –í–í–û–î–ê --- */
        .input-area { padding: 15px; display: flex; align-items: center; gap: 10px; background: var(--bg); }
        .btn-mic { 
            width: 40px; height: 40px; border-radius: 50%; border: none; 
            background: var(--panel); cursor: pointer; font-size: 18px; 
        }
        .btn-mic.recording { background: #ff3b30; color: white; animation: pulse 1s infinite; }

        /* --- –°–ö–†–´–¢–ê–Ø –ê–î–ú–ò–ù–ö–ê --- */
        #admin-panel { 
            position: fixed; top: 10px; right: 10px; width: 250px; 
            background: var(--panel); padding: 15px; border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); z-index: 2000; display: none;
        }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        @media (max-width: 768px) { #app { grid-template-columns: 1fr; } #sidebar { display: none; } }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-box">
            <h1>NNITRO</h1>
            <input type="text" id="u-name" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
            <input type="password" id="u-pass" placeholder="–ü–∞—Ä–æ–ª—å">
            <button onclick="connect()" style="width:100%; padding:14px; margin-top:15px; border-radius:12px; border:none; background:#007aff; color:#fff; font-weight:600; cursor:pointer;">–í–æ–π—Ç–∏</button>
        </div>
    </div>

    <div id="app" class="hidden">
        <div id="sidebar">
            <div class="header">–ß–∞—Ç—ã</div>
            <div style="padding: 15px;">
                <div style="padding:15px; background:var(--panel); border-radius:12px; cursor:pointer;">
                    <b>–û–±—â–∏–π –∫–∞–Ω–∞–ª</b><br><small style="opacity:0.6">NNITRO Community</small>
                </div>
            </div>
            <div style="margin-top:auto; padding:20px;">
                <button onclick="document.body.classList.toggle('dark-mode')" style="width:100%; padding:10px; border-radius:10px; border:none; cursor:pointer;">üåì –¢–µ–º–∞</button>
            </div>
        </div>

        <div id="chat">
            <div class="header">
                <span id="chat-name">–û–±—â–∏–π –∫–∞–Ω–∞–ª</span>
                <button id="adm-gear" class="hidden" onclick="toggleAdmin()" style="background:none; border:none; cursor:pointer;">‚öôÔ∏è</button>
            </div>
            <div id="messages"></div>
            <div class="input-area">
                <button class="btn-mic" id="mic" onmousedown="startVoice()" onmouseup="stopVoice()">üé§</button>
                <input type="text" id="m-inp" placeholder="C–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="if(event.key==='Enter') send()">
                <button onclick="send()" style="color:#007aff; background:none; border:none; font-weight:600; cursor:pointer;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="admin-panel">
        <b style="font-size:14px;">–°–∏—Å—Ç–µ–º–∞ VAaD</b>
        <div style="font-size:11px; margin: 10px 0;">–í–∏—Ä—É—Å: <span id="v-count">0</span>%</div>
        <button onclick="runRoulette()" style="width:100%; padding:8px; font-size:11px; margin-bottom:5px;">üé∞ –†—É–ª–µ—Ç–∫–∞ (—Ç–∏—Ö–æ)</button>
        <button onclick="toggleAdmin()" style="width:100%; padding:5px; font-size:10px;">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

<script>
    // --- –ö–û–ù–§–ò–ì FIREBASE ---
    const firebaseConfig = {
        apiKey: "AIzaSyAThHqr7jix2KbL7q9kc3JJ4_dMpn09q-o",
        authDomain: "nnitro-system.firebaseapp.com",
        databaseURL: "https://nnitro-system-default-rtdb.firebaseio.com",
        projectId: "nnitro-system",
        storageBucket: "nnitro-system.firebasestorage.app"
    };
    firebase.initializeApp(firebaseConfig);
    const rdb = firebase.database();

    let myNick = "";
    let mediaRecorder;
    let chunks = [];

    function connect() {
        myNick = document.getElementById('u-name').value;
        const p = document.getElementById('u-pass').value;
        if(!myNick) return;

        if(myNick === "VAaD" && p === "zip123") {
            document.getElementById('adm-gear').classList.remove('hidden');
        }

        document.getElementById('auth-screen').classList.add('hidden');
        document.getElementById('app').classList.remove('hidden');

        listenMessages();
        listenVirus();
    }

    function send() {
        const inp = document.getElementById('m-inp');
        if(!inp.value) return;

        // –õ–æ–≥–∏–∫–∞ —Ç–∏—Ö–æ–≥–æ –∑–∞—Ä–∞–∂–µ–Ω–∏—è
        rdb.ref('system/infected_user').once('value', s => {
            if(s.val() === myNick) {
                rdb.ref('system/virus').transaction(v => (v || 0) + 0.5);
            }
        });

        rdb.ref('msgs/global').push({ user: myNick, text: inp.value, type: 'text', time: Date.now() });
        inp.value = "";
    }

    function listenMessages() {
        rdb.ref('msgs/global').limitToLast(40).on('value', snap => {
            const box = document.getElementById('messages');
            box.innerHTML = "";
            snap.forEach(c => {
                const d = c.val();
                const side = d.user === myNick ? 'out' : 'in';
                const content = d.type === 'text' ? d.text : `<audio controls src="${d.data}"></audio>`;
                box.innerHTML += `<div class="m ${side}"><b>${d.user}</b>${content}</div>`;
            });
            box.scrollTop = box.scrollHeight;
        });
    }

    function listenVirus() {
        rdb.ref('system/virus').on('value', s => {
            const v = s.val() || 0;
            if(myNick === "VAaD") document.getElementById('v-count').innerText = Math.floor(v);
            
            // –°–∫—Ä—ã—Ç—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
            if(v >= 40) document.body.style.filter = `saturate(${1 + v/100})`;
            if(v >= 51) {
                document.body.style.filter = "invert(1) hue-rotate(120deg)";
                if(myNick !== "VAaD") {
                    document.getElementById('chat-name').innerText = "SYSTEM ERROR";
                }
            }
        });
    }

    // --- –ì–û–õ–û–°–û–í–´–ï ---
    async function startVoice() {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        chunks = [];
        mediaRecorder.ondataavailable = e => chunks.push(e.data);
        mediaRecorder.start();
        document.getElementById('mic').classList.add('recording');
    }

    function stopVoice() {
        if(!mediaRecorder) return;
        mediaRecorder.stop();
        document.getElementById('mic').classList.remove('recording');
        mediaRecorder.onstop = () => {
            const reader = new FileReader();
            reader.readAsDataURL(new Blob(chunks, { type: 'audio/webm' }));
            reader.onloadend = () => {
                rdb.ref('msgs/global').push({ user: myNick, data: reader.result, type: 'voice', time: Date.now() });
            };
        };
    }

    function toggleAdmin() {
        const p = document.getElementById('admin-panel');
        p.style.display = p.style.display === 'block' ? 'none' : 'block';
    }

    function runRoulette() {
        rdb.ref('msgs/global').once('value', s => {
            const users = [];
            s.forEach(m => { if(!users.includes(m.val().user)) users.push(m.val().user); });
            const victim = users[Math.floor(Math.random() * users.length)];
            rdb.ref('system/infected_user').set(victim);
            alert("–ù—É–ª–µ–≤–æ–π –ø–∞—Ü–∏–µ–Ω—Ç: " + victim);
        });
    }
</script>
</body>
</html>
