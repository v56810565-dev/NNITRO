<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>NNITRO 2026 PRESTIGE</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --main: #ff6600; --bg: #2b2b2b; --side: #383838; --text: #f0f0f0; --msg: #404040; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg); color: var(--text); height: 100vh; display: flex; overflow: hidden; }
        
        /* AUTH */
        #auth { position: fixed; inset: 0; background: var(--bg); z-index: 1000; display: flex; align-items: center; justify-content: center; }
        .auth-card { background: var(--side); padding: 35px; border-radius: 10px; width: 350px; border-top: 4px solid var(--main); box-shadow: 0 10px 25px rgba(0,0,0,0.4); }
        input { width: 100%; padding: 12px; margin: 8px 0; background: #1a1a1a; border: 1px solid #444; color: #fff; border-radius: 5px; }
        .btn { width: 100%; padding: 12px; border: none; background: var(--main); color: #fff; font-weight: bold; cursor: pointer; border-radius: 5px; text-transform: uppercase; }

        /* UI */
        #app { display: none; width: 100%; height: 100vh; flex-direction: row; }
        .sidebar { width: 320px; background: var(--side); border-right: 1px solid #222; display: flex; flex-direction: column; }
        .chat-zone { flex: 1; display: flex; flex-direction: column; background: #333; }
        
        /* TABS */
        .tabs { display: flex; background: #222; border-bottom: 1px solid #111; }
        .tab { flex: 1; padding: 12px; text-align: center; cursor: pointer; font-size: 11px; font-weight: bold; opacity: 0.5; }
        .tab.active { opacity: 1; color: var(--main); border-bottom: 2px solid var(--main); }

        /* LIST */
        .list { flex: 1; overflow-y: auto; }
        .item { padding: 12px 15px; border-bottom: 1px solid #444; cursor: pointer; display: flex; align-items: center; gap: 12px; }
        .item:hover { background: #444; }
        .ava { width: 38px; height: 38px; background: #555; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; border: 2px solid #666; }

        /* MESSAGES */
        .msgs { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; }
        .m { max-width: 70%; padding: 10px 14px; border-radius: 12px; font-size: 14px; line-height: 1.4; position: relative; }
        .m.in { background: var(--msg); align-self: flex-start; border-bottom-left-radius: 2px; }
        .m.out { background: var(--main); color: #fff; align-self: flex-end; border-bottom-right-radius: 2px; }
        .m b { display: block; font-size: 10px; margin-bottom: 4px; opacity: 0.8; }

        /* ADMIN & SETTINGS */
        #adm-menu { display: none; padding: 10px; background: #1a1a1a; border-bottom: 1px solid var(--main); flex-wrap: wrap; gap: 5px; }
        .adm-btn { font-size: 9px; padding: 4px 6px; background: #333; border: 1px solid var(--main); color: #fff; cursor: pointer; }

        .footer { padding: 15px; background: var(--side); display: flex; gap: 10px; align-items: center; }
        .mic { background: none; border: none; font-size: 22px; cursor: pointer; }
        .recording { color: #f00; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.3; } }
    </style>
</head>
<body>

<div id="auth">
    <div class="auth-card">
        <h2 style="text-align:center; color:var(--main); margin-bottom:15px;">NNITRO 2026</h2>
        <input id="a_key" placeholder="ACCESS CODE (NNITRO-2026)">
        <input id="a_login" placeholder="LOGIN">
        <input id="a_pass" type="password" placeholder="PASSWORD">
        <button class="btn" onclick="auth()">ENTER SYSTEM</button>
    </div>
</div>

<div id="app">
    <aside class="sidebar">
        <div id="adm-menu">
            <button class="adm-btn" onclick="adminBan(10)">BAN 10M</button>
            <button class="adm-btn" onclick="adminBan(30)">BAN 30M</button>
            <button class="adm-btn" onclick="adminBan(60)">BAN 1H</button>
            <button class="adm-btn" onclick="adminBan(99999)">PERM</button>
            <button class="adm-btn" onclick="adminUnban()" style="border-color:lime">UNBAN</button>
            <button class="adm-btn" onclick="adminClear()" style="border-color:red">CLEAR</button>
        </div>
        <div style="padding:15px; background:#222; display:flex; justify-content:space-between; align-items:center;">
            <div>
                <b id="my_nick" onclick="toggleAdm()" style="cursor:pointer">---</b><br>
                <small onclick="changeNick()" style="font-size:9px; color:var(--main); cursor:pointer;">[–ò–ó–ú–ï–ù–ò–¢–¨ –ù–ò–ö]</small>
            </div>
            <button onclick="blockUser()" style="font-size:9px; background:none; border:1px solid #555; color:#aaa; padding:2px;">BLOCK</button>
        </div>
        <div class="tabs">
            <div class="tab active" onclick="setTab('group')">–ì–†–£–ü–ü–´</div>
            <div class="tab" onclick="setTab('dm')">–õ–ò–ß–ö–ê</div>
            <div class="tab" onclick="setTab('chan')">–ö–ê–ù–ê–õ–´</div>
        </div>
        <div class="list" id="list_box"></div>
    </aside>

    <main class="chat-zone">
        <div style="padding:15px; background:#222; border-bottom:1px solid #111; font-weight:bold;" id="chat_title">MAIN CHANNEL</div>
        <div class="msgs" id="msg_box"></div>
        <div class="footer">
            <button id="mic_btn" class="mic" onclick="toggleMic()">üéôÔ∏è</button>
            <input id="msg_in" placeholder="Write message..." style="flex:1; margin:0">
            <button class="btn" style="width:60px; margin:0;" onclick="sendText()">OK</button>
        </div>
    </main>
</div>

<script>
    const CODE = "NNITRO-2026";
    // –í—à–∏—Ç—ã–µ –∞–¥–º–∏–Ω—ã
    const HARD_ADMINS = { "VAaD": "zip123", "IFRAKOBBI": "777888" };

    const cfg = { databaseURL: "https://nnitro-system-default-rtdb.firebaseio.com" }; // –ó–ê–ú–ï–ù–ò –ù–ê –°–í–û–Æ
    firebase.initializeApp(cfg);
    const db = firebase.database();

    let my = null, curChat = "GLOBAL", curTab = 'group', rec, chunks = [];

    async function auth() {
        const k = document.getElementById('a_key').value.trim();
        const l = document.getElementById('a_login').value.trim();
        const p = document.getElementById('a_pass').value;

        if (k !== CODE) return alert("ACCESS DENIED");

        // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—à–∏—Ç—ã—Ö –∞–¥–º–∏–Ω–æ–≤
        if (HARD_ADMINS[l] && HARD_ADMINS[l] === p) {
            my = { n: l, p: p, v: true };
            return startApp();
        }

        // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—ã—á–Ω—ã—Ö –≤ –±–∞–∑–µ
        const s = await db.ref('u/'+l).once('value');
        if (s.exists()) {
            const d = s.val();
            if (d.p !== p) return alert("WRONG PASS");
            if (d.b && d.b > Date.now()) return alert("BANNED UNTIL: " + new Date(d.b).toLocaleString());
            my = d;
        } else {
            my = { n: l, p: p, v: false, reg: Date.now() };
            await db.ref('u/'+l).set(my);
        }
        startApp();
    }

    function startApp() {
        document.getElementById('auth').style.display = 'none';
        document.getElementById('app').style.display = 'flex';
        document.getElementById('my_nick').innerText = my.n + (my.v ? ' ‚òÖ' : '');
        setTab('group');
    }

    function setTab(t) {
        curTab = t;
        document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
        event.target.classList.add('active');
        const box = document.getElementById('list_box'); box.innerHTML = '';
        
        if(t === 'group') addListItem('üåç –û–ë–©–ê–Ø –ì–†–£–ü–ü–ê', 'GLOBAL', 'üõ∞Ô∏è');
        if(t === 'chan') addListItem('üì¢ –ö–ê–ù–ê–õ –ù–û–í–û–°–¢–ï–ô', 'NEWS', 'üî•');
        if(t === 'dm') {
            db.ref('u').once('value', s => {
                s.forEach(u => { if(u.key !== my.n) addListItem(u.key, u.key, 'üë§'); });
            });
        }
    }

    function addListItem(name, id, icon) {
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `<div class="ava">${icon}</div><b>${name}</b>`;
        div.onclick = () => switchChat(id, name);
        document.getElementById('list_box').appendChild(div);
    }

    function switchChat(id, title) {
        curChat = id; document.getElementById('chat_title').innerText = title;
        const path = (curTab !== 'dm') ? 'rooms/'+id : 'priv/'+[my.n, id].sort().join('_');
        db.ref(path).off();
        db.ref(path).limitToLast(50).on('value', s => {
            const box = document.getElementById('msg_box'); box.innerHTML = '';
            s.forEach(m => {
                const d = m.val();
                if(my.block && my.block[d.u]) return; // –ò–≥–Ω–æ—Ä –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
                let body = d.t.startsWith('data:audio') ? `<audio src="${d.t}" controls style="height:35px;"></audio>` : d.t;
                box.innerHTML += `<div class="m ${d.u === my.n ? 'out' : 'in'}"><b>${d.u}</b>${body}</div>`;
            });
            box.scrollTop = box.scrollHeight;
        });
    }

    function sendText(val = null) {
        const t = val || document.getElementById('msg_in').value.trim();
        if(!t) return;
        const path = (curTab !== 'dm') ? 'rooms/'+curChat : 'priv/'+[my.n, curChat].sort().join('_');
        db.ref(path).push({ u: my.n, t: t, d: Date.now() });
        document.getElementById('msg_in').value = '';
    }

    async function toggleMic() {
        const b = document.getElementById('mic_btn');
        if(!rec || rec.state === "inactive") {
            const s = await navigator.mediaDevices.getUserMedia({ audio: true });
            rec = new MediaRecorder(s);
            rec.ondataavailable = e => chunks.push(e.data);
            rec.onstop = () => {
                const r = new FileReader();
                r.readAsDataURL(new Blob(chunks));
                r.onloadend = () => sendText(r.result);
                chunks = [];
            };
            rec.start(); b.classList.add('recording');
        } else {
            rec.stop(); b.classList.remove('recording');
        }
    }

    // --- –§–£–ù–ö–¶–ò–ò –ü–†–û–§–ò–õ–Ø ---
    async function changeNick() {
        const newN = prompt("–ù–æ–≤—ã–π –Ω–∏–∫:");
        if(newN) {
            await db.ref('u/'+my.n).remove();
            my.n = newN;
            await db.ref('u/'+newN).set(my);
            location.reload();
        }
    }

    async function blockUser() {
        const t = prompt("–ù–∏–∫ –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–∏–≥–Ω–æ—Ä):");
        if(t) {
            if(!my.block) my.block = {};
            my.block[t] = true;
            await db.ref('u/'+my.n+'/block').set(my.block);
            alert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "+t+" –≤ —á–µ—Ä–Ω–æ–º —Å–ø–∏—Å–∫–µ.");
        }
    }

    // --- –ê–î–ú–ò–ù–ö–ê ---
    function toggleAdm() { if(my.v) { let m = document.getElementById('adm-menu'); m.style.display = m.style.display==='flex'?'none':'flex'; } }
    
    async function adminBan(min) {
        const t = prompt("–ù–∏–∫ –¥–ª—è –±–∞–Ω–∞:");
        if(!t) return;
        const time = (min === 99999) ? 9999999999999 : Date.now() + (min * 60000);
        await db.ref('u/'+t).update({ b: time });
        alert(t + " –∑–∞–±–∞–Ω–µ–Ω.");
    }

    async function adminUnban() {
        const t = prompt("–ù–∏–∫ –¥–ª—è —Ä–∞–∑–±–∞–Ω–∞:");
        if(t) await db.ref('u/'+t).update({ b: null });
    }

    async function adminClear() {
        if(confirm("–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç?")) {
            const path = (curTab !== 'dm') ? 'rooms/'+curChat : 'priv/'+[my.n, curChat].sort().join('_');
            await db.ref(path).remove();
        }
    }
</script>
</body>
</html>
