<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>NNITRO 2026</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --c: #ff4500; --bg: #000; --t: #fff; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Courier New', monospace; }
        body { background: var(--bg); color: var(--t); height: 100vh; overflow: hidden; display: flex; }
        
        /* AUTH */
        #auth { position: fixed; inset: 0; background: #000; z-index: 999; display: flex; align-items: center; justify-content: center; }
        .box { width: 300px; padding: 20px; border: 1px solid #222; background: #050505; }
        input { width: 100%; padding: 10px; margin: 5px 0; background: #000; border: 1px solid #333; color: var(--c); outline: none; }
        .b { width: 100%; padding: 10px; border: none; cursor: pointer; font-weight: bold; margin-top: 5px; text-transform: uppercase; }
        .b-m { background: var(--c); color: #000; }

        /* UI */
        #app { display: none; width: 100%; height: 100vh; flex-direction: row; }
        .side { width: 260px; border-right: 1px solid #111; display: flex; flex-direction: column; background: #050505; }
        .adm-p { display: none; background: #1a0000; padding: 10px; border-bottom: 1px solid red; gap: 5px; flex-wrap: wrap; }
        .a-btn { font-size: 9px; padding: 3px; background: red; color: #fff; border: none; cursor: pointer; }

        .u-list { flex: 1; overflow-y: auto; }
        .u-item { padding: 12px; border-bottom: 1px solid #111; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 8px; }
        .on { width: 6px; height: 6px; background: #0f0; border-radius: 50%; box-shadow: 0 0 5px #0f0; }

        .chat { flex: 1; display: flex; flex-direction: column; }
        .msgs { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .m { max-width: 85%; padding: 8px 12px; border-radius: 2px; font-size: 14px; position: relative; }
        .m.in { background: #111; border-left: 2px solid var(--c); align-self: flex-start; }
        .m.out { background: var(--c); color: #000; align-self: flex-end; }
        .m b { display: block; font-size: 10px; margin-bottom: 3px; opacity: 0.7; }

        .bar { padding: 15px; background: #000; border-top: 1px solid #111; display: flex; gap: 10px; align-items: center; }
        .rec { font-size: 20px; cursor: pointer; background: none; border: none; filter: grayscale(1); }
        .active { filter: grayscale(0); transform: scale(1.1); }
    </style>
</head>
<body>

<div id="auth">
    <div class="box">
        <h2 style="text-align:center; color:var(--c); margin-bottom:10px;">SYSTEM 2026</h2>
        <input id="un" placeholder="LOGIN">
        <input id="up" type="password" placeholder="PASSWORD">
        <div id="r-f" style="display:none"><input id="sk" placeholder="ACCESS CODE"></div>
        <button class="b b-m" onclick="doAuth()">ENTER</button>
        <div onclick="tglR()" style="font-size:10px; margin-top:10px; text-align:center; opacity:0.3; cursor:pointer;">CREATE ACCOUNT</div>
    </div>
</div>

<div id="app">
    <div class="side">
        <div id="adm-p" class="adm-p">
            <button class="a-btn" onclick="adm('ban')">BAN</button>
            <button class="a-btn" onclick="adm('clear')">CLEAR</button>
            <button class="a-btn" onclick="adm('v')">SET V</button>
        </div>
        <div style="padding:15px; border-bottom:1px solid #111">
            <b id="my-n" onclick="tglA()" style="cursor:pointer">---</b>
            <div id="st" style="font-size:9px; color:#444; margin-top:4px;">SCANNING...</div>
        </div>
        <div class="u-list" id="u-l"></div>
    </div>
    <div class="chat">
        <div style="padding:10px; background:#000; border-bottom:1px solid #111; font-size:12px;" id="c-h">MAIN</div>
        <div class="msgs" id="ms"></div>
        <div class="bar">
            <button id="rc" class="rec" onclick="hVox()">üé§</button>
            <input id="mi" placeholder="Write..." style="margin:0; flex:1">
            <button class="b b-m" style="width:60px; margin:0;" onclick="snd()">OK</button>
        </div>
    </div>
</div>

<script>
    // --- –°–ï–ö–†–ï–¢–ù–´–ô –ö–û–î ---
    const CODE = "NNITRO-2026";
    // ---------------------

    const cfg = { databaseURL: "https://nnitro-system-default-rtdb.firebaseio.com" };
    firebase.initializeApp(cfg);
    const db = firebase.database();

    let my = null, cur = "GLOBAL", isR = false, rec, chunks = [];

    function tglR() { isR = !isR; document.getElementById('r-f').style.display = isR ? 'block' : 'none'; }
    function tglA() { if(my.v) { let p = document.getElementById('adm-p'); p.style.display = p.style.display==='flex'?'none':'flex'; } }

    async function doAuth() {
        const n = document.getElementById('un').value.trim();
        const p = document.getElementById('up').value;
        const k = document.getElementById('sk').value.trim();
        if(!n || !p) return;

        if(isR) {
            if(k !== CODE) return;
            const s = await db.ref('u/'+n).once('value');
            if(s.exists()) return;
            my = { n, p, v: (n==='VAaD'), reg: Date.now(), on: true };
            await db.ref('u/'+n).set(my);
        } else {
            const s = await db.ref('u/'+n).once('value');
            if(!s.exists() || s.val().p !== p || s.val().b) return;
            my = s.val();
            await db.ref('u/'+n).update({ on: true });
        }
        start();
    }

    function start() {
        document.getElementById('auth').style.display = 'none';
        document.getElementById('app').style.display = 'flex';
        document.getElementById('my-n').innerText = my.n + (my.v ? ' [V]' : '');
        
        db.ref('u').on('value', snap => {
            const l = document.getElementById('u-l');
            l.innerHTML = `<div class="u-item" onclick="sw('GLOBAL')">üåç MAIN CHANNEL</div>`;
            l.innerHTML += `<div class="u-item" onclick="sw('ZIP_AI')">ü§ñ ZIP NEURO</div>`;
            let count = 0;
            snap.forEach(c => {
                const u = c.val(); if(u.on) count++;
                if(u.n === my.n || u.b) return;
                l.innerHTML += `<div class="u-item" onclick="sw('${u.n}')"><div class="on"></div><b>${u.n} ${u.v?'üíé':''}</b></div>`;
            });
            document.getElementById('st').innerText = "ONLINE: " + count;
        });
        sw('GLOBAL');
    }

    function sw(t) {
        cur = t; document.getElementById('c-h').innerText = t;
        const p = (t==='GLOBAL' || t==='ZIP_AI') ? 'r/'+t : 'p/'+[my.n, t].sort().join('_');
        db.ref(p).off();
        db.ref(p).limitToLast(40).on('value', s => {
            const b = document.getElementById('ms'); b.innerHTML = '';
            s.forEach(m => {
                const d = m.val();
                let c = d.t.startsWith('data:audio') ? `<audio src="${d.t}" controls style="height:30px;"></audio>` : d.t;
                b.innerHTML += `<div class="m ${d.u===my.n?'out':'in'}"><b>${d.u}</b>${c}</div>`;
            });
            b.scrollTop = b.scrollHeight;
        });
    }

    function snd(t = null) {
        const v = t || document.getElementById('mi').value.trim();
        if(!v) return;
        const p = (cur==='GLOBAL' || cur==='ZIP_AI') ? 'r/'+cur : 'p/'+[my.n, cur].sort().join('_');
        db.ref(p).push({ u: my.n, t: v });
        document.getElementById('mi').value = '';
        if(cur === 'ZIP_AI' && !t) {
            setTimeout(() => db.ref(p).push({ u: 'ZIP', t: "SYSTEM ONLINE. CODE: "+CODE }), 600);
        }
    }

    async function hVox() {
        if(!rec || rec.state === "inactive") {
            const s = await navigator.mediaDevices.getUserMedia({ audio: true });
            rec = new MediaRecorder(s);
            rec.ondataavailable = e => chunks.push(e.data);
            rec.onstop = () => {
                const r = new FileReader();
                r.readAsDataURL(new Blob(chunks));
                r.onloadend = () => snd(r.result);
                chunks = [];
            };
            rec.start();
            document.getElementById('rc').classList.add('active');
        } else {
            rec.stop();
            document.getElementById('rc').classList.remove('active');
        }
    }

    async function adm(a) {
        const t = prompt("User:");
        if(!t && a!=='clear') return;
        if(a==='ban') await db.ref('u/'+t).update({ b: true, on: false });
        if(a==='v') await db.ref('u/'+t).update({ v: true });
        if(a==='clear') {
            const p = (cur==='GLOBAL' || cur==='ZIP_AI') ? 'r/'+cur : 'p/'+[my.n, cur].sort().join('_');
            db.ref(p).remove();
        }
    }
    window.onbeforeunload = () => { if(my) db.ref('u/'+my.n).update({ on: false }); };
</script>
</body>
</html>
