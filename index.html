<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NNITRO Messenger PRO</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --bg: #0e1621; --side: #17212b; --msg-in: #182533; --msg-out: #2b5278; --accent: #2481cc; }
        body { background: var(--bg); color: #fff; font-family: -apple-system, system-ui, sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* –ó–∞—Å—Ç–∞–≤–∫–∏ */
        .overlay { position: fixed; inset: 0; background: var(--side); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; text-align: center; }
        input { padding: 12px; border-radius: 8px; border: 1px solid #2f3942; background: #1d2733; color: #fff; width: 260px; margin-bottom: 15px; outline: none; }
        button { padding: 10px 25px; background: var(--accent); border: none; border-radius: 8px; color: #fff; cursor: pointer; font-weight: bold; }

        /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
        #sidebar { width: 280px; background: var(--side); border-right: 1px solid #080d13; display: flex; flex-direction: column; }
        .group-item { padding: 15px; border-bottom: 1px solid #0e1621; cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: space-between; }
        .group-item:hover { background: #232e3a; }
        .group-item.active { background: var(--accent); }
        .badge-admin { background: #ff4b4b; font-size: 9px; padding: 2px 6px; border-radius: 4px; font-weight: bold; }

        /* –ß–∞—Ç */
        #chat-main { flex: 1; display: flex; flex-direction: column; background: #0e1621; }
        #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        
        .m { max-width: 80%; padding: 10px 15px; border-radius: 12px; font-size: 14px; position: relative; }
        .m.my { align-self: flex-end; background: var(--msg-out); border-bottom-right-radius: 2px; }
        .m.other { align-self: flex-start; background: var(--msg-in); border-bottom-left-radius: 2px; }
        
        .sender { font-size: 11px; font-weight: bold; color: #40a7e3; display: flex; align-items: center; gap: 4px; margin-bottom: 4px; }
        .verify { color: #33a1f2; width: 14px; height: 14px; }
        .time { font-size: 10px; opacity: 0.5; text-align: right; margin-top: 5px; }

        #input-bar { background: var(--side); padding: 15px; display: flex; gap: 10px; border-top: 1px solid #080d13; }
        #msgInput { flex: 1; margin: 0; border-radius: 20px; background: #1d2733; text-align: left; }
        #locked { display: none; background: #17212b; color: #777; text-align: center; padding: 18px; font-size: 13px; }
    </style>
</head>
<body>

    <div id="gate" class="overlay">
        <h2>NNITRO ACCESS</h2>
        <input type="password" id="p" placeholder="–ö–æ–¥ –¥–æ—Å—Ç—É–ø–∞">
        <button onclick="auth()">–í–æ–π—Ç–∏</button>
    </div>

    <div id="nick-gate" class="overlay" style="display:none">
        <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ</h2>
        <input type="text" id="n" placeholder="–ù–∏–∫–Ω–µ–π–º (–ê–¥–º–∏–Ω: VAaD)">
        <button onclick="reg()">–ù–∞—á–∞—Ç—å</button>
    </div>

    <div id="sidebar">
        <div style="padding: 22px; font-weight: bold; font-size: 20px; color: var(--accent);">NNITRO SYSTEM</div>
        <div class="group-item active" onclick="switchGroup('channel', this)">üì¢ –ö–∞–Ω–∞–ª –ù–æ–≤–æ—Å—Ç–µ–π <span class="badge-admin">READ ONLY</span></div>
        <div class="group-item" onclick="switchGroup('general', this)">üë• –û–±—â–∏–π —á–∞—Ç</div>
        <div class="group-item" onclick="switchGroup('secret', this)">ü§´ –°–µ–∫—Ä–µ—Ç–Ω—ã–π —Å–µ–∫—Ç–æ—Ä</div>
    </div>

    <div id="chat-main">
        <div id="messages"></div>
        <div id="locked">–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (VAaD) –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å –∑–¥–µ—Å—å.</div>
        <div id="input-bar">
            <input type="text" id="msgInput" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="if(event.key==='Enter')send()">
            <button onclick="send()">‚û§</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAThHqr7jix2KbL7q9kc3JJ4_dMpn09q-o",
            authDomain: "nnitro-system.firebaseapp.com",
            databaseURL: "https://nnitro-system-default-rtdb.firebaseio.com",
            projectId: "nnitro-system",
            storageBucket: "nnitro-system.firebasestorage.app",
            messagingSenderId: "927836043640",
            appId: "1:927836043640:web:d9b320347c888b1d1f708d"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let user = localStorage.getItem('nn_name') || "";
        let currentGroup = 'channel';
        let chatRef = null;

        const vTag = '<svg class="verify" viewBox="0 0 24
