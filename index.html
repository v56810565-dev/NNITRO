<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NNITRO OS</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root {
            --rainbow: linear-gradient(45deg, #ff0000, #ff7300, #fffb00, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8, #ff0000);
            --dark: #121212;
            --glass: rgba(255, 255, 255, 0.1);
        }
        body { 
            margin: 0; font-family: 'Segoe UI', sans-serif; height: 100vh; 
            background: #000; color: white; display: flex; 
        }
        
        /* –†–∞–¥—É–∂–Ω—ã–π —Ñ–æ–Ω */
        #app-bg {
            position: fixed; inset: 0; z-index: -1;
            background: var(--rainbow); background-size: 400%;
            animation: move 20s linear infinite; opacity: 0.15; filter: blur(50px);
        }
        @keyframes move { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }

        /* –í—Ö–æ–¥ –∏ –ü—Ä–æ—Ñ–∏–ª—å */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 2000; }
        .win { background: #1e1e1e; padding: 30px; border-radius: 20px; border: 1px solid #333; width: 300px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #444; background: #222; color: #fff; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #0078d4; border: none; color: #fff; border-radius: 8px; cursor: pointer; font-weight: bold; }

        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
        #sidebar { width: 300px; background: rgba(20,20,20,0.8); border-right: 1px solid #333; display: flex; flex-direction: column; }
        #chat-main { flex: 1; display: flex; flex-direction: column; }
        
        .user-card { padding: 15px; border-bottom: 1px solid #333; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .avatar { font-size: 24px; background: #333; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        
        #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .msg { max-width: 70%; padding: 12px; border-radius: 15px; background: #262626; position: relative; }
        .msg.my { align-self: flex-end; background: #005a9e; }
        .msg .sender { font-size: 11px; color: #aaa; margin-bottom: 5px; display: flex; align-items: center; gap: 5px; }
        
        #admin-panel { padding: 10px; background: #000; font-size: 12px; color: #0f0; border-bottom: 1px solid #0f0; display: none; }

        .verify { color: #00a2ff; width: 14px; }
    </style>
</head>
<body>
    <div id="app-bg"></div>

    <div id="gate" class="overlay">
        <div class="win">
            <h2>NNITRO OS</h2>
            <input type="password" id="sys_pass" placeholder="–ö–æ–¥ —Å–∏—Å—Ç–µ–º—ã">
            <button onclick="checkSys()">–î–æ—Å—Ç—É–ø</button>
        </div>
    </div>

    <div id="auth-gate" class="overlay" style="display:none">
        <div class="win">
            <h3 id="auth-title">–í—Ö–æ–¥ –≤ –ê–∫–∫–∞—É–Ω—Ç</h3>
            <input type="text" id="u_name" placeholder="–ù–∏–∫–Ω–µ–π–º">
            <input type="password" id="u_pass" placeholder="–õ–∏—á–Ω—ã–π –ø–∞—Ä–æ–ª—å">
            <input type="text" id="u_emoji" placeholder="–¢–≤–æ–π —ç–º–æ–¥–∑–∏ (–Ω–∞–ø—Ä. üòé)" maxlength="2">
            <input type="text" id="u_desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–ü—Ä–∏–≤–µ—Ç, —è...)">
            <button onclick="accountAction()">–í–æ–π—Ç–∏ / –°–æ–∑–¥–∞—Ç—å</button>
        </div>
    </div>

    <div id="sidebar">
        <div id="admin-panel">ADMIN: <span id="user-count">0</span> —é–∑–µ—Ä–æ–≤ –æ–Ω–ª–∞–π–Ω</div>
        <div style="padding: 20px; font-weight: bold; border-bottom: 1px solid #333;">–ß–∞—Ç—ã –∏ –õ—é–¥–∏</div>
        <div id="user-list"></div>
    </div>

    <div id="chat-main">
        <div id="messages"></div>
        <div style="padding: 15px; display: flex; gap: 10px; background: rgba(0,0,0,0.5);">
            <input type="text" id="m_input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="if(event.key==='Enter')send()">
            <button style="width: 60px;" onclick="send()">‚û§</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAThHqr7jix2KbL7q9kc3JJ4_dMpn09q-o",
            databaseURL: "https://nnitro-system-default-rtdb.firebaseio.com",
            projectId: "nnitro-system",
            appId: "1:927836043640:web:d9b320347c888b1d1f708d"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        let myNick = localStorage.getItem('nn_nick');
        let myData = null;

        function checkSys() {
            if(document.getElementById('sys_pass').value === 'NNITRO-2026') {
                document.getElementById('gate').style.display = 'none';
                document.getElementById('auth-gate').style.display = 'flex';
            }
        }

        async function accountAction() {
            const nick = document.getElementById('u_name').value.trim();
            const pass = document.getElementById('u_pass').value;
            const emoji = document.getElementById('u_emoji').value || "üë§";
            const desc = document.getElementById('u_desc').value || "–ü–æ–ª—å–∑—É—é—Å—å NNITRO";

            if(!nick || !pass) return alert("–ó–∞–ø–æ–ª–Ω–∏ –ø–æ–ª—è!");

            const snap = await db.ref('users/' + nick).once('value');
            const exist = snap.val();

            if(exist) {
                if(exist.pass !== pass) return alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ª–∏—á–Ω—ã–π –ø–∞—Ä–æ–ª—å!");
                myData = exist;
            } else {
                myData = { nick, pass, emoji, desc, isAdmin: nick.includes('VAaD') };
                await db.ref('users/' + nick).set(myData);
            }

            localStorage.setItem('nn_nick', nick);
            myNick = nick;
            document.getElementById('auth-gate').style.display = 'none';
            initApp();
        }

        function initApp() {
            // –ê–¥–º–∏–Ω–∫–∞
            if(myNick.includes('VAaD')) {
                document.getElementById('admin-panel').style.display = 'block';
                db.ref('users').on('value', s => {
                    document.getElementById('user-count').innerText = Object.keys(s.val() || {}).length;
                });
            }

            // –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            db.ref('users').on('value', snap => {
                const list = document.getElementById('user-list');
                list.innerHTML = "";
                snap.forEach(u => {
                    const d = u.val();
                    list.innerHTML += `
                        <div class="user-card" onclick="alert('–ü—Ä–æ—Ñ–∏–ª—å: ${d.desc}')">
                            <div class="avatar">${d.emoji}</div>
                            <div>
                                <b>${d.nick} ${d.nick.includes('VAaD') ? 'üíé' : ''}</b><br>
                                <small style="color: #666">${d.desc}</small>
                            </div>
                        </div>`;
                });
            });

            // –ß–∞—Ç
            db.ref('main_chat').limitToLast(50).on('value', snap => {
                const area = document.getElementById('messages');
                area.innerHTML = "";
                snap.forEach(m => {
                    const d = m.val();
                    const isMy = d.u === myNick;
                    area.innerHTML += `
                        <div class="msg ${isMy ? 'my' : ''}">
                            <div class="sender">${d.e} ${d.u}</div>
                            ${d.t}
                        </div>`;
                });
                area.scrollTop = area.scrollHeight;
            });
        }

        function send() {
            const t = document.getElementById('m_input').value;
            if(t.trim()) {
                db.ref('main_chat').push({ u: myNick, t: t, e: myData.emoji });
                document.getElementById('m_input').value = "";
            }
        }
    </script>
</body>
</html>
