<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NNITRO ULTIMATE</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --orange: #ff8c00; --dark: #1a1a1a; --gray: #2d2d2d; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--orange); color: #fff; height: 100vh; overflow: hidden; }

        /* AUTH SCREEN */
        #auth { position: fixed; inset: 0; background: var(--orange); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .auth-card { width: 85%; max-width: 350px; background: rgba(0,0,0,0.1); padding: 30px; border-radius: 25px; backdrop-filter: blur(10px); }
        input, select { width: 100%; padding: 15px; margin: 8px 0; border: none; border-radius: 15px; font-size: 16px; background: #fff; color: #000; outline: none; }
        .auth-btns { display: flex; gap: 10px; margin-top: 15px; }
        .btn { flex: 1; padding: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-black { background: #000; color: #fff; }
        .btn-white { background: #fff; color: #000; }

        /* MAIN APP */
        #app { display: none; flex-direction: column; height: 100vh; background: var(--orange); }
        .top-nav { padding: 15px 20px; background: rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .search-bar { padding: 10px 20px; }
        .search-bar input { margin: 0; background: rgba(255,255,255,0.2); color: #fff; }
        .search-bar input::placeholder { color: #eee; }

        .list-container { flex: 1; overflow-y: auto; padding: 15px; }
        .chat-item { background: rgba(255,255,255,0.15); padding: 15px; border-radius: 20px; margin-bottom: 10px; display: flex; align-items: center; gap: 15px; position: relative; }
        .badge { background: #007bff; color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 10px; display: flex; align-items: center; justify-content: center; position: absolute; left: 45px; bottom: 15px; border: 2px solid var(--orange); }
        .ava { width: 50px; height: 50px; border-radius: 50%; background: #fff; color: var(--orange); display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; }
        
        /* CHAT WINDOW */
        #chat-win { position: fixed; inset: 0; background: var(--orange); display: none; flex-direction: column; z-index: 9000; }
        .chat-head { padding: 15px; background: rgba(0,0,0,0.1); display: flex; align-items: center; gap: 15px; font-size: 18px; }
        .msg-box { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; }
        .bubble { padding: 12px 18px; border-radius: 20px; max-width: 75%; background: rgba(255,255,255,0.25); position: relative; }
        .bubble.me { background: #000; align-self: flex-end; }
        .bubble b { display: block; font-size: 12px; margin-bottom: 4px; opacity: 0.8; }
        
        .chat-tools { padding: 15px; background: rgba(0,0,0,0.1); display: flex; align-items: center; gap: 10px; }
        .tool-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: #fff; }
        
        /* ADMIN PANEL */
        #adm-bar { display: none; background: #ff3b3b; padding: 8px; justify-content: center; gap: 10px; font-size: 12px; }

        .verified::after { content: ' ‚úî'; color: #007bff; font-weight: bold; }
    </style>
</head>
<body>

    <div id="auth">
        <div class="auth-card">
            <h1 style="text-align:center; margin-bottom:20px; font-size:40px;">NNITRO</h1>
            <input type="text" id="log-n" placeholder="–ù–∏–∫–Ω–µ–π–º">
            <input type="password" id="log-p" placeholder="–ü–∞—Ä–æ–ª—å">
            <select id="log-e"><option value="üî•">üî• –û–≥–æ–Ω—å</option><option value="üëë">–ö–æ—Ä–æ–Ω–∞</option><option value="ü•∑">–ù–∏–Ω–¥–∑—è</option></select>
            <input type="password" id="log-k" placeholder="–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥">
            <div class="auth-btns">
                <button class="btn btn-white" onclick="authUser('reg')">–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</button>
                <button class="btn btn-black" onclick="authUser('login')">–í–•–û–î</button>
            </div>
        </div>
    </div>

    <div id="app">
        <div id="adm-bar">
            <b>ADMIN PANEL:</b>
            <button onclick="admOp('ban')">BAN</button>
            <button onclick="admOp('mute')">MUTE</button>
            <button onclick="db.ref().remove()">WIPE</button>
        </div>
        <div class="top-nav">
            <div>
                <h2 id="me-name" onclick="toggleAdm()"></h2>
                <small id="stat">–û–Ω–ª–∞–π–Ω: 0</small>
            </div>
            <div id="me-ava" class="ava"></div>
        </div>
        <div class="search-bar"><input type="text" placeholder="–ü–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤..."></div>
        <div class="list-container" id="chat-list">
            <div class="chat-item" onclick="openCh('ZIP AI')"><div class="ava">ü§ñ</div><b>ZIP AI Bot</b></div>
            <div class="chat-item" onclick="openCh('FAVORITES')"><div class="ava">‚≠ê</div><b>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</b></div>
            <div class="chat-item" onclick="openCh('GLOBAL')"><div class="ava">üåê</div><b>–û–±—â–∏–π –ß–∞—Ç</b></div>
        </div>
    </div>

    <div id="chat-win">
        <div class="chat-head">
            <span onclick="closeCh()" style="font-size:30px; cursor:pointer;">‚Üê</span>
            <b id="chat-title"></b>
        </div>
        <div class="msg-box" id="msg-box"></div>
        <div class="chat-tools">
            <button class="tool-btn" onclick="sendMedia('üì∑')">üì∑</button>
            <button class="tool-btn" onclick="sendMedia('üìπ')">üìπ</button>
            <input type="text" id="m-input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." style="flex:1; margin:0;">
            <button class="tool-btn" id="mic-btn" onclick="sendMedia('üé§')">üé§</button>
            <button onclick="sendMsg()" style="background:#000; border:none; color:#fff; padding:10px 20px; border-radius:12px; font-weight:bold;">OK</button>
        </div>
    </div>

    <script>
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        const config = { databaseURL: "https://nnitro-system-default-rtdb.firebaseio.com" };
        firebase.initializeApp(config);
        const db = firebase.database();
        let my = {}, activeChat = "";

        async function authUser(type) {
            const n = document.getElementById('log-n').value.trim();
            const p = document.getElementById('log-p').value;
            const e = document.getElementById('log-e').value;
            const k = document.getElementById('log-k').value;

            if (k !== 'NNITRO-2026' || !n) return alert("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞");

            const userRef = db.ref('users/' + n);
            const snap = await userRef.once('value');

            if (type === 'login' && !snap.exists()) return alert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω");
            if (snap.exists() && snap.val().p !== p) return alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å");

            my = { n, p, e, v: (n === 'VAaD' || n === 'Admin'), online: true };
            await userRef.update(my);

            document.getElementById('auth').style.display = 'none';
            document.getElementById('app').style.display = 'flex';
            document.getElementById('me-name').className = my.v ? 'verified' : '';
            document.getElementById('me-name').innerText = n;
            document.getElementById('me-ava').innerText = e;
            loadList();
        }

        function loadList() {
            db.ref('users').on('value', s => {
                const container = document.getElementById('chat-list');
                const stat = document.getElementById('stat');
                let on = 0;
                
                // –û—á–∏—Å—Ç–∫–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —é–∑–µ—Ä–æ–≤, –Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö
                container.innerHTML = `
                    <div class="chat-item" onclick="openCh('ZIP AI')"><div class="ava">ü§ñ</div><b>ZIP AI Bot</b></div>
                    <div class="chat-item" onclick="openCh('FAVORITES')"><div class="ava">‚≠ê</div><b>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</b></div>
                    <div class="chat-item" onclick="openCh('GLOBAL')"><div class="ava">üåê</div><b>–û–±—â–∏–π –ß–∞—Ç</b></div>
                `;

                s.forEach(u => {
                    const ud = u.val();
                    if(ud.online) on++;
                    if(ud.n === my.n) return;
                    container.innerHTML += `
                        <div class="chat-item" onclick="openCh('${ud.n}')">
                            <div class="ava">${ud.e}</div>
                            ${ud.online ? '<div class="badge"></div>' : ''}
                            <b class="${ud.v ? 'verified' : ''}">${ud.n}</b>
                        </div>
                    `;
                });
                stat.innerText = "–û–Ω–ª–∞–π–Ω: " + on;
            });
        }

        function openCh(target) {
            activeChat = target;
            document.getElementById('chat-title').innerText = target;
            document.getElementById('chat-win').style.display = 'flex';
            
            const path = (target === 'GLOBAL' || target === 'ZIP AI' || target === 'FAVORITES') ? 'rooms/'+target : 'pvt/'+[my.n, target].sort().join('_');
            
            db.ref(path).off();
            db.ref(path).on('value', s => {
                const box = document.getElementById('msg-box'); box.innerHTML = '';
                s.forEach(m => {
                    const d = m.val();
                    box.innerHTML += `<div class="bubble ${d.u === my.n ? 'me' : ''}"><b>${d.u}</b>${d.t}</div>`;
                });
                box.scrollTop = box.scrollHeight;
            });
        }

        async function sendMsg() {
            const t = document.getElementById('m-input').value.trim();
            if(!t) return;
            const path = (activeChat === 'GLOBAL' || activeChat === 'ZIP AI' || activeChat === 'FAVORITES') ? 'rooms/'+activeChat : 'pvt/'+[my.n, activeChat].sort().join('_');
            
            await db.ref(path).push({ u: my.n, t: t });
            document.getElementById('m-input').value = '';

            if(activeChat === 'ZIP AI') {
                setTimeout(() => {
                    db.ref(path).push({ u: 'ZIP AI', t: '–Ø –ø–æ–ª—É—á–∏–ª —Ç–≤–æ–π –∑–∞–ø—Ä–æ—Å! –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é... üöÄ' });
                }, 1000);
            }
        }

        function sendMedia(type) {
            const path = (activeChat === 'GLOBAL' || activeChat === 'ZIP AI' || activeChat === 'FAVORITES') ? 'rooms/'+activeChat : 'pvt/'+[my.n, activeChat].sort().join('_');
            db.ref(path).push({ u: my.n, t: type + ' [–ú–µ–¥–∏–∞-—Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ]' });
        }

        function toggleAdm() { if(my.v) { const b = document.getElementById('adm-bar'); b.style.display = b.style.display === 'flex' ? 'none' : 'flex'; } }
        function closeCh() { document.getElementById('chat-win').style.display = 'none'; }
        
        window.onbeforeunload = () => { if(my.n) db.ref('users/'+my.n).update({online: false}); };
    </script>
</body>
</html>
